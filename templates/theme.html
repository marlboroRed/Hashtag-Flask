<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>테마별 해시태그 생성기</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/static/style.css">
</head>

<body>
  <div class="outer-wrapper">
    <div class="container">

      {% if not hashtags %}
      <form method="POST">
        <div class="theme-box">
          {% for theme in themes %}
          <label>
            <input type="checkbox" name="themes" value="{{ theme }}" {% if theme in selected_themes %}checked{% endif %}>
            {{ theme }}
          </label>
          {% endfor %}
        </div>
        <button type="submit">해시태그 추천</button>

        <!-- ✅ 앱 내부에서만 보이도록 버튼을 JS에서 삽입 -->
        <div id="reward-container"></div>
      </form>
      {% endif %}

      {% if hashtags %}
      <div class="result">
        <h3>추천 해시태그</h3>
        <div id="hashtag-list">
          {% for tag in hashtags.split() %}
            <label class="hashtag-item">
              <input type="checkbox" class="tag-check" value="{{ tag }}">
              {{ tag }}
            </label>
          {% endfor %}
        </div>
        <div class="copy-buttons">
          <button onclick="copySelected()">선택된 항목 복사</button>
          <button onclick="copyAll()">전체 복사</button>
        </div>
      </div>
      {% endif %}

      {% if message %}
      <p class="error">{{ message }}</p>
      {% endif %}

    </div>
  </div>

  <!-- 홈으로 이동 -->
  <a href="/" class="home-button" title="메인으로 돌아가기">
    <img src="/static/home-icon.png" alt="홈으로" class="home-icon">
  </a>

  <!-- ✅ 해시태그 복사 함수 -->
  <script>
    function copySelected() {
      const checks = document.querySelectorAll(".tag-check:checked");
      const tags = Array.from(checks).map(el => el.value).join(" ");
      if (tags) {
        navigator.clipboard.writeText(tags).then(() => alert("선택된 해시태그 복사 완료!"));
      } else {
        alert("선택된 해시태그가 없습니다.");
      }
    }

    function copyAll() {
      const allTags = Array.from(document.querySelectorAll(".tag-check")).map(el => el.value).join(" ");
      navigator.clipboard.writeText(allTags).then(() => alert("전체 복사 완료!"));
    }
  </script>

  <!-- ✅ 에러창 확인 버튼 -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const errorBox = document.querySelector(".error");
      if (errorBox) {
        const btnContainer = document.createElement("div");
        btnContainer.className = "error-buttons";

        const dismissBtn = document.createElement("button")
        dismissBtn.textContent = "확인";
        dismissBtn.className = "error-dismiss";
        dismissBtn.onclick = () => errorBox.style.display = "none";
        btnContainer.appendChild(dismissBtn);

        errorBox.appendChild(btnContainer);
      }
    });
  </script>

  <!-- ✅ AndroidAd에서만 버튼 보이게 -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      if (typeof AndroidAd !== "undefined" && AndroidAd.showRewardAd) {
        const btn = document.createElement("button");
        btn.id = "reward-ad-button";
        btn.innerText = "광고보고 다시 생성하기";
        btn.onclick = () => {
          console.log("📡 AndroidAd.showRewardAd 호출 시도");
          AndroidAd.showRewardAd();
        };
        document.getElementById("reward-container").appendChild(btn);
      }
    });
  </script>
</body>
</html>
